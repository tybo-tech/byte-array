<section class="banner-section">
  <app-banner
    title="Get a Smart Quote for Your Project"
    description="Answer a few questions and get a tailored quote for your software development needs."
  ></app-banner>
</section>

<section class="quotes-form-section">
  <div class="container">
    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
      <div class="progress-text">
        Step {{ currentStep }} of {{ totalSteps }}: {{ currentStepData.title }}
      </div>
    </div>

    <div class="quotes-content fade-in">
      <h2>{{ currentStepData.title }}</h2>
      <p>{{ currentStepData.description }}</p>

      <!-- Success/Error Message -->
      <div *ngIf="submitMessage && currentStep === totalSteps" 
           class="form-message" 
           [class.success]="submitSuccess" 
           [class.error]="!submitSuccess">
        <i class="fas" [class.fa-check-circle]="submitSuccess" [class.fa-exclamation-triangle]="!submitSuccess"></i>
        {{ submitMessage }}
        <button *ngIf="submitSuccess" (click)="startOver()" class="btn-secondary">
          Submit Another Quote
        </button>
      </div>

      <form [formGroup]="quoteForm" *ngIf="!submitSuccess">
        
        <!-- Step 1: Project Type -->
        <div *ngIf="currentStep === 1" class="step-content">
          <div class="form-group">
            <label>What type of software solution do you need? *</label>
            <div class="radio-grid">
              <div *ngFor="let option of serviceOptions" class="radio-option">
                <input 
                  type="radio" 
                  [id]="'service-' + option.value"
                  formControlName="service" 
                  [value]="option.value"
                >
                <label [for]="'service-' + option.value" class="radio-label">
                  <span class="radio-text">{{ option.label }}</span>
                </label>
              </div>
            </div>
            <div *ngIf="getFieldError('service')" class="error-message">
              {{ getFieldError('service') }}
            </div>
          </div>

          <div class="form-group">
            <label>What type of project is this? *</label>
            <div class="radio-grid">
              <div *ngFor="let option of projectTypeOptions" class="radio-option">
                <input 
                  type="radio" 
                  [id]="'projectType-' + option.value"
                  formControlName="projectType" 
                  [value]="option.value"
                >
                <label [for]="'projectType-' + option.value" class="radio-label">
                  <span class="radio-text">{{ option.label }}</span>
                </label>
              </div>
            </div>
            <div *ngIf="getFieldError('projectType')" class="error-message">
              {{ getFieldError('projectType') }}
            </div>
          </div>

          <div class="form-group">
            <label>What features do you need? (Select all that apply)</label>
            <div class="checkbox-grid">
              <div *ngFor="let feature of featureOptions" class="checkbox-option">
                <input 
                  type="checkbox" 
                  [id]="'feature-' + feature.value"
                  [checked]="isFeatureSelected(feature.value)"
                  (change)="onFeatureChange(feature.value, $any($event.target).checked)"
                >
                <label [for]="'feature-' + feature.value" class="checkbox-label">
                  {{ feature.label }}
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Budget & Timeline -->
        <div *ngIf="currentStep === 2" class="step-content">
          <div class="form-group">
            <label>What's your estimated budget? *</label>
            <div class="budget-grid">
              <div *ngFor="let option of budgetOptions" class="budget-option">
                <input 
                  type="radio" 
                  [id]="'budget-' + option.value"
                  formControlName="budget" 
                  [value]="option.value"
                >
                <label [for]="'budget-' + option.value" class="budget-label">
                  <span class="budget-amount">{{ option.label }}</span>
                  <span class="budget-range">{{ option.range }}</span>
                </label>
              </div>
            </div>
            <div *ngIf="getFieldError('budget')" class="error-message">
              {{ getFieldError('budget') }}
            </div>
          </div>

          <div class="form-group">
            <label>When do you need this completed? *</label>
            <div class="timeline-grid">
              <div *ngFor="let option of timelineOptions" class="timeline-option">
                <input 
                  type="radio" 
                  [id]="'timeline-' + option.value"
                  formControlName="timeline" 
                  [value]="option.value"
                >
                <label [for]="'timeline-' + option.value" class="timeline-label">
                  <span class="timeline-duration">{{ option.label }}</span>
                  <span class="timeline-description">{{ option.description }}</span>
                </label>
              </div>
            </div>
            <div *ngIf="getFieldError('timeline')" class="error-message">
              {{ getFieldError('timeline') }}
            </div>
          </div>

          <div class="form-group">
            <label>Preferred team size?</label>
            <div class="team-grid">
              <div *ngFor="let option of teamSizeOptions" class="team-option">
                <input 
                  type="radio" 
                  [id]="'teamSize-' + option.value"
                  formControlName="teamSize" 
                  [value]="option.value"
                >
                <label [for]="'teamSize-' + option.value" class="team-label">
                  <span class="team-size">{{ option.label }}</span>
                  <span class="team-description">{{ option.description }}</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Project Details -->
        <div *ngIf="currentStep === 3" class="step-content">
          <div class="form-group">
            <label for="message">Tell us about your project *</label>
            <textarea
              id="message"
              formControlName="message"
              placeholder="Please describe your project goals, target users, key features, technical requirements, and any other relevant details that will help us provide an accurate quote."
              [class.error]="isFieldInvalid('message')"
              rows="8"
            ></textarea>
            <div class="char-counter">
              {{ quoteForm.get('message')?.value?.length || 0 }} characters (minimum 20)
            </div>
            <div *ngIf="getFieldError('message')" class="error-message">
              {{ getFieldError('message') }}
            </div>
          </div>
        </div>

        <!-- Step 4: Contact Information -->
        <div *ngIf="currentStep === 4" class="step-content">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Full Name *</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                placeholder="Enter your full name"
                [class.error]="isFieldInvalid('name')"
              />
              <div *ngIf="getFieldError('name')" class="error-message">
                {{ getFieldError('name') }}
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email Address *</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                placeholder="Enter your email"
                [class.error]="isFieldInvalid('email')"
              />
              <div *ngIf="getFieldError('email')" class="error-message">
                {{ getFieldError('email') }}
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone"
                placeholder="Enter your phone number"
              />
            </div>

            <div class="form-group">
              <label for="company">Company Name</label>
              <input
                type="text"
                id="company"
                formControlName="company"
                placeholder="Enter your company name"
              />
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="form-navigation">
          <button 
            type="button" 
            class="btn-secondary" 
            *ngIf="currentStep > 1"
            (click)="previousStep()"
          >
            <i class="fas fa-arrow-left"></i>
            Previous
          </button>

          <button 
            type="button" 
            class="btn-ghost" 
            *ngIf="currentStep === 3"
            (click)="skipStep()"
          >
            Skip for now
          </button>

          <button 
            type="button" 
            class="btn-primary" 
            *ngIf="currentStep < totalSteps"
            (click)="nextStep()"
          >
            Next Step
            <i class="fas fa-arrow-right"></i>
          </button>

          <button 
            type="submit" 
            class="btn-primary"
            *ngIf="currentStep === totalSteps"
            [disabled]="isSubmitting"
            (click)="onSubmit()"
          >
            <span *ngIf="!isSubmitting">
              <i class="fas fa-paper-plane"></i>
              Get My Quote
            </span>
            <span *ngIf="isSubmitting">
              <i class="fas fa-spinner fa-spin"></i>
              Submitting...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="quotes-how-it-works">
  <div class="container">
    <h2 class="fade-in">How Our Smart Quote Process Works</h2>
    <div class="steps fade-in delay-1">
      <div class="step">
        <i class="fas fa-clipboard-list"></i>
        <h3>Steps 1-2</h3>
        <p>Tell us about your project type, features, budget, and timeline in South African Rands.</p>
      </div>
      <div class="step">
        <i class="fas fa-comment-dots"></i>
        <h3>Step 3</h3>
        <p>Describe your project details and requirements.</p>
      </div>
      <div class="step">
        <i class="fas fa-user-check"></i>
        <h3>Step 4</h3>
        <p>Provide your contact information for our response.</p>
      </div>
      <div class="step">
        <i class="fas fa-handshake"></i>
        <h3>Response</h3>
        <p>Receive a detailed quote within 24-48 hours.</p>
      </div>
    </div>
  </div>
</section>

<app-faq></app-faq>

<app-final-cta></app-final-cta>
